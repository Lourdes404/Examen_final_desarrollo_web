@{
    Layout = "_Layout";
}

<div class="container mt-4">

    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Listado de Turnos</h4>
        </div>

        <div class="card-body">

            <table class="table table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Paciente</th>
                        <th>Clínica actual</th>
                        <th>Fecha turno</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Paciente?.Nombre</td>
                            <td>@item.Clinica?.Nombre</td>
                            <td>@item.FechaHora.ToString("dd/MM/yyyy HH:mm")</td>
                            <td class="text-center">
                                <button type="button"
                                        class="btn btn-sm btn-warning px-3"
                                        data-bs-toggle="modal"
                                        data-bs-target="#reasignarModal"
                                        data-turno-id="@item.Id">
                                    <i class="bi bi-arrow-repeat me-1"></i> Reasignar
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>
    </div>
</div>


<!-- Modal de Reasignación -->
<div class="modal fade" id="reasignarModal" tabindex="-1" aria-labelledby="reasignarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">

            <form asp-action="Reasignar" method="post">

                <div class="modal-header bg-warning">
                    <h5 class="modal-title fw-bold" id="reasignarLabel">Reasignar turno</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body">

                    <input type="hidden" id="TurnoId" name="TurnoId" />

                    <div class="mb-3">
                        <label for="NuevaClinicaId" class="form-label fw-semibold">Nueva clínica</label>
                        <select id="NuevaClinicaId" name="NuevaClinicaId" class="form-select shadow-sm" required>
                            <option value="">-- Selecciona una clínica --</option>
                            @foreach (var clinica in (List<Examen_final_desarrollo_web.Models.Clinica>)ViewBag.Clinicas)
                            {
                                <option value="@clinica.Id">@clinica.Nombre</option>
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="Motivo" class="form-label fw-semibold">Motivo de la reasignación</label>
                        <textarea id="Motivo" name="Motivo" class="form-control shadow-sm" rows="3" required></textarea>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save me-1"></i> Guardar cambios
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        var reasignarModal = document.getElementById('reasignarModal');
        reasignarModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var turnoId = button.getAttribute('data-turno-id');
            document.getElementById('TurnoId').value = turnoId;
        });
    </script>
}
